<!doctype html>
<html lang="es" data-theme="dark" data-ui="neo-atlas" data-ui-skin="newsroom">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#0b0f14" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <title>RLC ‚Äî Mapa Interactivo (Votaci√≥n)</title>

  <!-- (Opcional) Si quieres heredar tu piel general, descomenta:
  <link rel="stylesheet" href="./styles.css?v=2.3.9" />
  -->

  <link rel="stylesheet" href="./rlcmap.css?v=2.3.9" />

  <!-- ‚úÖ Mapa pro: D3 + topojson-client (si falla, rlcmap.js cae al modo hotspots) -->
  <script defer src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/topojson-client@3/dist/topojson-client.min.js"></script>
</head>

<body class="mode-map">
  <main class="mapApp" role="application" aria-label="Mapa interactivo de votaci√≥n">
    <header class="topbar">
      <div class="brand">
        <div class="dotLive" aria-hidden="true"></div>
        <div>
          <div class="title">MAPA INTERACTIVO</div>
          <div class="sub">Vota tocando el mapa ¬∑ RLC v2.3.9</div>
        </div>
      </div>

      <div class="status">
        <div class="pill" id="mapModePill">Viewer</div>
        <div class="pill mono" id="mapRoomPill">room: ‚Äî</div>
        <div class="pill mono" id="mapKeyPill">key: ‚Äî</div>
        <div class="pill mono dim" id="mapEndpointPill">endpoint: ‚Äî</div>
      </div>
    </header>

    <section class="layout">
      <!-- MAPA -->
      <section class="mapStage" aria-label="Mapa del mundo">
        <div class="mapFrame" id="mapFrame" aria-label="Mapa interactivo">
          <!-- Fondo ‚Äúmapa‚Äù -->
          <div class="mapOcean"></div>
          <div class="mapGrid" aria-hidden="true"></div>

          <!-- ‚úÖ SVG MAPA REAL -->
          <div class="mapSvgWrap" id="mapSvgWrap" aria-label="Mapa real">
            <svg id="mapSvg" class="mapSvg" role="img" aria-label="Mapa del mundo">
              <g id="mapG"></g>
            </svg>
          </div>

          <!-- Fallback hotspots (si no carga el mapa real) -->
          <div class="hotspots" id="hotspots" hidden></div>

          <!-- HUD sobre el mapa -->
          <div class="mapHud">
            <div class="mapHudRow">
              <div class="mapHudTitle" id="pollTitle">Votaci√≥n</div>
              <div class="mapHudTimer mono" id="pollTimer">‚Äî</div>
            </div>
            <div class="mapHudHint" id="pollHint">Haz click en un pa√≠s para votar. Doble click en USA para ver estados.</div>
          </div>

          <!-- Controles -->
          <div class="mapControls" aria-label="Controles del mapa">
            <button class="btnMini" id="btnZoomIn"  type="button" title="Zoom +">Ôºã</button>
            <button class="btnMini" id="btnZoomOut" type="button" title="Zoom ‚àí">Ôºç</button>
            <button class="btnMini" id="btnZoomReset" type="button" title="Reset">‚ü≥</button>
            <button class="btnMini btnBack" id="btnBack" type="button" title="Volver" hidden>‚Üê Volver</button>
          </div>

          <!-- Tooltip -->
          <div class="mapTooltip" id="mapTooltip" hidden></div>

          <!-- Toast -->
          <div class="toast" id="mapToast" aria-live="polite"></div>
        </div>
      </section>

      <!-- SIDEBAR -->
      <aside class="mapSide" aria-label="Panel de votaci√≥n">
        <div class="sideCard">
          <div class="sideHead">
            <div class="sideTitle">Votaci√≥n en directo</div>
            <div class="sideSub mono" id="pollMeta">‚Äî</div>
          </div>

          <div class="sideActions">
            <button class="btn" id="btnRefresh" type="button">‚ü≥ Refrescar</button>
            <button class="btn danger" id="btnVoteClear" type="button">üßπ Borrar mi voto</button>
          </div>

          <div class="choiceList" id="choiceList" aria-label="Opciones"></div>

          <div class="sideNote">
            <div class="noteLine">üìå Tip: si una opci√≥n no est√° activa (no sale en la lista), el mapa no la deja votar.</div>
            <div class="noteLine dim">El voto se identifica por dispositivo (best-effort).</div>
          </div>
        </div>

        <!-- ADMIN -->
        <div class="sideCard adminCard" id="adminCard" style="display:none;">
          <div class="sideHead">
            <div class="sideTitle">Admin</div>
            <div class="sideSub dim">Arranca/para polls y aplica ganador al Player</div>
          </div>

          <label class="lbl">Endpoint Worker (Cloudflare)</label>
          <input class="inp mono" id="adminEndpoint" placeholder="https://xxxxx.workers.dev" />

          <label class="lbl">Room</label>
          <input class="inp mono" id="adminRoom" placeholder="global / o tu KEY" />

          <label class="lbl">Admin secret (NO se mete en la URL)</label>
          <div class="row">
            <input class="inp mono" id="adminSecret" type="password" placeholder="pegas tu secret aqu√≠" />
            <button class="btn" id="btnSaveSecret" type="button">Guardar</button>
            <button class="btn danger" id="btnForgetSecret" type="button">Borrar</button>
          </div>

          <label class="lbl">Opciones (coma / saltos de l√≠nea)</label>
          <textarea class="ta mono" id="adminOptions" rows="4"
            placeholder="Ej: US, VE, ES&#10;O: US-CA, US-NY, US-FL"></textarea>

          <label class="lbl">Duraci√≥n (segundos)</label>
          <input class="inp mono" id="adminDuration" type="number" min="10" max="600" value="120" />

          <div class="row">
            <button class="btn ok" id="btnStart" type="button">‚ñ∂ Start</button>
            <button class="btn danger" id="btnStop" type="button">‚èπ Stop</button>
            <button class="btn" id="btnApplyWinner" type="button">üèÜ Aplicar ganador</button>
          </div>

          <div class="adminHint mono" id="adminCmdHint">‚Äî</div>

          <div class="row">
            <button class="btn" id="btnDebugCmd" type="button">üß™ PING (test)</button>
          </div>

          <div class="sideNote dim">
            <div class="noteLine">‚ö†Ô∏è ‚ÄúAplicar ganador‚Äù intenta elegir una cam por tags/t√≠tulo/lugar y manda <b>GOTO</b> al player.</div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <script defer src="./rlcmap.js?v=2.3.9"></script>
</body>
</html>
